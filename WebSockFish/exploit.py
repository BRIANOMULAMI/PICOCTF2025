import asyncio
import websockets

async def websocket_exploit():
    uri = "ws://verbal-sleep.picoctf.net:51112/ws/"

    async with websockets.connect(uri) as ws:
        try:
            print("[+] Connected to WebSocket")

            # Step 1: Send UCI handshake
            await ws.send("uci")
            response = await ws.recv()
            print("[SERVER] UCI Response:", response)

            await ws.send("isready")
            response = await ws.recv()
            print("[SERVER] Ready Response:", response)

            # Step 2: Set up a game position
            await ws.send("position startpos moves e2e4")
            response = await ws.recv()
            print("[SERVER] Position Response:", response)

            # Step 3: Request the best move
            await ws.send("go depth 10")
            response = await ws.recv()
            print("[SERVER] Best Move:", response)

        except asyncio.TimeoutError:
            print("[ERROR] No response received (Timeout).")
        except websockets.exceptions.ConnectionClosedError as e:
            print(f"[ERROR] Connection closed: {e}")

asyncio.run(websocket_exploit())
